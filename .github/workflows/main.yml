name: Windows-Pro-VPN-Enabled

on:
  workflow_dispatch:

jobs:
  rdp-vpn:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: 1. Optimasi Performa & Power
        run: |
          powercfg /s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c
          Set-MpPreference -DisableRealtimeMonitoring $true
          Write-Host "âœ… Sistem Siap."

      - name: 2. Instalasi Chrome & Cloudflare WARP (VPN)
        run: |
          Write-Host "Menginstal Chrome dan Cloudflare WARP..."
          choco install googlechrome cloudflare-warp -y
          Write-Host "âœ… Software terinstal."

      - name: 3. Instalasi RustDesk (Remote Desktop)
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.7/rustdesk-1.3.7-x86_64.exe"
          $out = "$env:TEMP\rustdesk.exe"
          Invoke-WebRequest -Uri $url -OutFile $out
          Start-Process $out -ArgumentList "--install" -Wait

      - name: 4. Konfigurasi RustDesk
        run: |
          & "C:\Program Files\RustDesk\rustdesk.exe" --password VpnPro2026
          Start-Sleep -Seconds 20
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          echo "RUST_ID=$id" >> $env:GITHUB_ENV

      - name: 5. Informasi Login & Instruksi VPN
        run: |
          Write-Host "`n==========================================" -ForegroundColor Cyan
          Write-Host "ðŸš€ VPS RDP DENGAN VPN READY" -ForegroundColor Cyan
          Write-Host "=========================================="
          Write-Host "ID RUSTDESK : $env:RUST_ID" -ForegroundColor Yellow
          Write-Host "PASSWORD    : VpnPro2026" -ForegroundColor Yellow
          Write-Host "VPN TOOL    : Cloudflare WARP Terinstal"
          Write-Host "=========================================="
          Write-Host "TIPS: Gunakan VPN di dalam Chrome (Extension) agar koneksi RDP tidak putus."

      - name: 6. Menjaga Sesi
        run: |
          while ($true) {
            Write-Host "[$(Get-Date -Format 'HH:mm:ss')] VPS Running..."
            Start-Sleep -Seconds 300
          }
