name: Windows-Pro-Performance-Auto

on:
  workflow_dispatch:

jobs:
  rdp-pro:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: 1. Optimasi Kernel & Power (High Priority)
        run: |
          powercfg /s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\PriorityControl' -Name "Win32PrioritySeparation" -Value 36
          Set-MpPreference -DisableRealtimeMonitoring $true
          Write-Host "âœ… Sistem diatur ke Performa Ultimate."

      - name: 2. Instalasi Software Otomatis (Chrome & CPU-Z)
        run: |
          Write-Host "Menginstal Google Chrome dan CPU-Z via Chocolatey..."
          # Chocolatey sudah terinstal di runner GitHub secara default
          choco install googlechrome cpuz -y
          Write-Host "âœ… Software berhasil terinstal."

      - name: 3. Setup RustDesk (Remote Desktop)
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.7/rustdesk-1.3.7-x86_64.exe"
          $out = "$env:TEMP\rustdesk.exe"
          Invoke-WebRequest -Uri $url -OutFile $out
          Start-Process $out -ArgumentList "--install" -Wait

      - name: 4. Konfigurasi Akses
        run: |
          & "C:\Program Files\RustDesk\rustdesk.exe" --password ProVps2026
          Start-Sleep -Seconds 20
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          echo "RUST_ID=$id" >> $env:GITHUB_ENV

      - name: 5. Informasi Login
        run: |
          Write-Host "`n==========================================" -ForegroundColor Cyan
          Write-Host "ðŸš€ VPS PRO AUTO-READY" -ForegroundColor Cyan
          Write-Host "=========================================="
          Write-Host "ID RUSTDESK : $env:RUST_ID" -ForegroundColor Yellow
          Write-Host "PASSWORD    : ProVps2026" -ForegroundColor Yellow
          Write-Host "SOFTWARE    : Chrome & CPU-Z Terinstal"
          Write-Host "=========================================="
          Write-Host "Silakan cek CPU-Z di Desktop untuk monitor beban kerja."

      - name: 6. Menjaga Sesi Tetap Aktif
        run: |
          while ($true) {
            Write-Host "[$(Get-Date -Format 'HH:mm:ss')] VPS Running - Menunggu instruksi berat..."
            Start-Sleep -Seconds 300
          }
