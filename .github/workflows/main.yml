name: Windows-High-Performance-RDP

on:
  workflow_dispatch:

jobs:
  heavy-task:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: 1. Unlock Maksimum Performa CPU
        run: |
          # Mengatur skema daya ke 'Ultimate Performance' (jika ada) atau 'High Performance'
          powercfg /s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c
          
          # Meningkatkan prioritas proses latar belakang (Background Services)
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\PriorityControl' -Name "Win32PrioritySeparation" -Value 36
          
          # Mematikan Windows Defender agar tidak memakan resource CPU
          Set-MpPreference -DisableRealtimeMonitoring $true
          Write-Host "âœ… CPU & Power dioptimalkan untuk beban berat."

      - name: 2. Instalasi RustDesk (Lightweight Remote)
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.7/rustdesk-1.3.7-x86_64.exe"
          $out = "$env:TEMP\rustdesk.exe"
          Invoke-WebRequest -Uri $url -OutFile $out
          Start-Process $out -ArgumentList "--install" -Wait

      - name: 3. Setup Password & Get ID
        run: |
          & "C:\Program Files\RustDesk\rustdesk.exe" --password KhususPerforma123
          Start-Sleep -Seconds 20
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          echo "RUST_ID=$id" >> $env:GITHUB_ENV

      - name: 4. Informasi Akses VPS
        run: |
          Write-Host "`n==========================================" -ForegroundColor Cyan
          Write-Host "ðŸš€ HIGH PERFORMANCE RDP READY" -ForegroundColor Cyan
          Write-Host "=========================================="
          Write-Host "ID RUSTDESK : $env:RUST_ID" -ForegroundColor Yellow
          Write-Host "PASSWORD    : KhususPerforma123" -ForegroundColor Yellow
          Write-Host "PERFORMA    : Max CPU Priority"
          Write-Host "=========================================="

      - name: 5. Menjaga Sesi (Keep Alive)
        run: |
          # Loop dengan prioritas rendah agar tidak mengganggu tugas utama
          while ($true) {
            Write-Host "[$(Get-Date -Format 'HH:mm:ss')] Sistem Berjalan pada Kapasitas Penuh..."
            Start-Sleep -Seconds 300
          }
